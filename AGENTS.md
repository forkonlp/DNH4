# DNH4 Development Guidelines for AI Agents

## Build/Lint/Test Commands

### Run All Tests
```bash
Rscript -e "devtools::test()"
```

### Run Single Test File
```bash
Rscript -e "devtools::test(filter = 'getcomment')"
```

### Run R CMD Check
```bash
R CMD check .
```

### Run with rcmdcheck (Recommended)
```bash
Rscript -e "rcmdcheck::rcmdcheck(args = c('--no-manual', '--as-cran'), error_on = 'warning')"
```

### Run Linting
```bash
Rscript -e "lintr::lint_package()"
```

### Test Coverage
```bash
Rscript -e "covr::codecov()"
```

### Install Dependencies
```bash
Rscript -e "pak::pak()"
```

### Build and Install Package
```bash
R CMD INSTALL .
```

---

## Code Style Guidelines

### Naming Conventions
- **Functions**: snake_case (e.g., `getContent`, `getUrlList`)
- **Variables**: snake_case (e.g., `news_title`, `news_links`)
- **Constants**: UPPER_SNAKE_CASE (e.g., `CATEGORY_MAIN`)

### Import Conventions
- Always use `package::function()` syntax for external functions
- Do not use `attach()` or `library()` in source code
- Import dependencies via roxygen2 tags:
  ```r
  #' @importFrom httr GET content user_agent
  #' @importFrom rvest read_html html_nodes html_text html_attr
  #' @importFrom tibble tibble
  #' @importFrom tidyr unnest
  ```

### Documentation (roxygen2)
- All exported functions MUST have roxygen2 documentation
- Use `#'` for documentation blocks
- Required tags: `@param`, `@return`, `@export`, `@importFrom`
- Examples section for exported functions:
  ```r
  #' @examples
  #'   getMainCategory()
  ```

### Data Structures
- Use `tibble::tibble()` for tidy data frames
- Use `data.frame(stringsAsFactors = F)` for legacy compatibility
- Do not use `stringsAsFactors = TRUE`

### Error Handling
- Use `tryCatch()` for robust error handling
- Always return meaningful defaults orNA values on error
- Example:
  ```r
  tryCatch({
    hobj <- rvest::read_html(turl)
    # ... processing ...
    return(result)
  }, error = function(e) {
    return(default_value)
  })
  ```

### String Encoding
- Always set UTF-8 encoding explicitly:
  ```r
  Encoding(title) <- "UTF-8"
  ```
- Use `Encoding(content) <- "UTF-8"` for text content
- Use `httr::content(x, encoding = "UTF-8")` for API responses

### Control Flow
- Use explicit `return()` statements
- Use `if (!identical(x, character(0)))` for empty checks
- Avoid deep nesting; use early returns

### Pipe Operator
- Do NOT use `%>%` pipe operator in this codebase
- Use explicit function calls and assignments instead

### Testing Patterns
- Test files: `tests/testthat/test-*.R`
- Use `context()` for test context
- Use `httptest::with_mock_api()` for API mocking
- Test assertions: `expect_equal()`, `expect_true()`, `expect_null()`

### Package Structure
- R source files: `R/*.R`
- Tests: `tests/testthat/`
- Mock data: `tests/testthat/news.v.daum.net/`, `tests/testthat/comment.daum.net/`
- Documentation: `man/*.Rd` (auto-generated by roxygen2)

### Dependency Management
- Core imports: httr, rvest, tidyr, tibble
- Dev dependencies: pak, httptest, testthat
- Use `renv` for reproducible environments

### Common Patterns
- URL validation with regex: `grepl("^https://v\\.daum\\.net/v", url)`
- Text cleaning with `gsub()` and `trimws()`
- DateTime parsing with `as.POSIXlt()`
- HTML parsing with rvest selectors

### Git Workflow
- Commit messages: descriptive, reference issues if applicable
- Pull requests: include tests for new features
- No force pushes to main branch
